<extend name="Common/base" />

<block name="header_config_add">
<script type="text/javascript">
var isty=false;
var condition = {
    event_id : '<{: isset($eventId)?$eventId:0 }>',
	build_id: '<{$buildings[0][2]}>',
	unit_id: '<{$units[0][0][1]}>',
	level : [0,0],
	area : [0,0],
	total : [0,0],
	hx : []
};
</script>
</block>

<block name="header">
<style>
    .speedbuy-bg
    {
        height:100%;width:100%;border-top: 1px solid #03A9F4;
    }
    .speedbuy-title
    {
        height:60px;width:100%;
    }
    .speedbuy-djs
    {
        position:absolute;top:10px;left:4%;
    }
    .speedbuy-djs .djs-ul
    {
        text-align:center;
        font-size:12px;
        font-weight:bold;
        color:#000;
    }
    .djs-time
    {
        color: #FFF;
        font-size: 16px;
        background: #FFF;
        padding: 0 6px 0 6px;
    }
    .begin-time
    {
        width: 100%;
        height: 60px;
        /* line-height: 60px; */
        margin-left: 42%;
        font-size: 18px;
        font-weight: bold;
        color: #000;
        margin-top: 10px;
    }
    .remark{
        position:absolute;
        top:15px;right:5%;
        font-size: 18px;
        color:#BFBFBF;
        font-weight: normal;
    }
    .speedbuy-content
    {
        height:100%;
        width:99%;
        margin:auto;
        /*background:#91AEC5;*/
        margin-top:1px;
        display:block;
    }
    .del-div{
        margin-left: 50%;
        transform: translate(-50%, -0%);
        margin-top:25px;
        width:25px;
        height: 25px;
        line-height: 22px;
        text-align:center;
        font-size:20px;
        /*font-weight:bold;*/
        color:#c6c3c3;
        background:#FFF;
        border-radius:50%;
        /*-webkit-box-shadow: 0 0 8px #7d7a7b;
        -moz-box-shadow: 0 0 8px #7d7a7b;
        box-shadow: 0 0 8px #7d7a7b;*/
        border: 1px solid #c6c3c3;
    }
    .buy-span
    {
        background:#BFBBBB;
        color:#FFF;
        padding:6px 9px 6px 9px;border-radius:5px;
    }
    .wxrgbuy-button
    {
        background:#eb3045;
        -webkit-box-shadow: 0 0 8px #D20E50;
        -moz-box-shadow: 0 0 8px #D20E50;
        box-shadow: 0 0 8px #D20E50;
        cursor:pointer;
    }
    .user-voucher-footer-tabs-btn{padding:8px 30px;background:#03a9f4;color:#D6D5D5;}
    .user-voucher-footer-tabs-btn-select{background:#FFF;color:#03a9f4;font-weight:bold;}
    .user-project-view-content-rooms {
        top: 60px;
        bottom: 55px;
    }
    .ycwxrg
    {
        position:absolute;top:35px;right:1%;width:10%;text-align:center;
    }

    .user-project-view-content-gwc-wrapper {
        position: absolute;
        bottom: 45px;
        left: 4%;
        width: auto;
        z-index: 25;
    }

    .user-project-view-content-gwc-num-wrapper {
        position: absolute;
        top: 5px;
        left: 5px;
    }

    .speedbuy-content-li {

    }
    .speedbuy-content-li ul {
        height:75px;
    }
    .bxf-ul {
        margin-top:5px;
        border:1px solid #cecfd1;
    }
    .bxf-ds{background:#FFF;color:#2196F3;}
    .bxf-ss{background:#FFF;color:#2196F3;}
    .bxf-ds a{
        color:#2196F3;
    }
    .bxf-ss a{
        color:#2196F3;
    }
    .buy-suc{
        background: #f39900;
        -webkit-box-shadow: 0 0 8px #FF9800;
        -moz-box-shadow: 0 0 8px #FF9800;
        box-shadow: 0 0 8px #FF9800;
        cursor:pointer;
    }
    .div-zz{
        background: rgba(22, 22, 22, 0.8);
        z-index: 99999;
        position: absolute;
        width: 100%;
        height: 100%;
        display:none;
    }
    .show-suc-div {
        margin-left: 12px;
        margin-top: 25px;
        width: 25px;
        line-height: 25px;
        text-align: center;
        font-size: 13px;
        font-weight: bold;
        color: white;
        background: #f39900;
        border-radius: 50%;
        -webkit-box-shadow: 0 0 8px #FF9800;
        -moz-box-shadow: 0 0 8px #FF9800;
        box-shadow: 0 0 8px #FF9800;
    }
    .room_ys{
        background: #c00000;
        color: #FFF;
        border-color: #C00000;
    }
    .room_cggm{
        background: #009688;
        color: #FFF;
        border-color: #009688;
    }
    .jxz{
        color: #000;
        font-weight: 400;
    }
    .yks,.wks{background:#FFF;color: #eb3045;}

    #qrddbtn{cursor:pointer;}
    .qrddbtn{
        position: absolute;width:100%;height:45px;
        bottom:0px;text-align:center;line-height:45px;
        color:#FFF;font-size: 16px;
        background:#bdbcbd;
    }
    .tyyd{
        background:#eb3045;
    }
    .sc-bxfy-btn{
        cursor:pointer;
    }
    #checkbox_a1 {
        width: 18px;
        height: 18px;
    }
    .hdxz_div{
        position: absolute;
        width:100%;
        height:auto;
        top:0px;
        left:0px;
        bottom: 50px;
        z-index: 9999999;
        background: #FFF;
        display:none;
    }
    .hdxz_content{
        width: 90%;
        margin: 50% 0 0 5%;
        transform: translate(0%, 0%);
        white-space: pre-line;
        text-align: justify;
        text-justify: inter-ideograph;
        margin-top: 30px;
        overflow-y: hidden;
        height: auto;
    }
    .hdxz_footer {
        position: fixed;
        bottom: 0px;
        height: 50px;
        line-height: 50px;
        width: 100%;
        border-top: 1px solid #e6e6e6;
        background: #FFF;
        z-index: 999999999;
    }
</style>
<div id="zz01" class="div-zz" ></div>
<div id="showsuccess" class="div-success" >
    <div class="div-success-content">
        <ul>
            <li><span class="div-success-no"></span></li>
            <li class="div-success-area"></li>
            <li >售价：¥<span class="div-success-total"></span></li>
        </ul>
        <div>
            <div class="div-success-rgm">签约号：<{$wxrg['sjm']}></div>
            <div class="div-success-sm">请按流程办理认购手续，谢谢配合！</div>
            <div class="div-success-remark">选房信息会以短信形式发送到您的手机！</div>
        </div>
    </div>
    <div class="div-success-btn">关&nbsp;&nbsp;&nbsp;&nbsp;闭</div>
    <div class="div-success-ddinfo"><a href="/User/OrderHouse/ordershow/id/<{$eventId}>/oid/<{$cgroom['id']}>.html">订单详情</a></div>
</div>
<div class="common-header-wrapper">
    <input id="dpproj_id" value="<{$project['id']}>" style="display:none;">
    <div class="clearfix common-header js-wxrg-djs">			
        <div class="speedbuy-title">
            <div style="position:absolute;color:#FFF;z-index:-1;">
                <span class="a" id="djstemp" style="display:none;"><{$time}></span>秒<span class="b"></span>
                <span id="djstemp1" style="display:none;"><{$time1}></span>
            </div>
            <div class="speedbuy-djs">
                <ul class="djs-ul">
                    <li id="djs-type-title" style="font-weight: 400;">
                    <if condition="$iswks eq 1">
                        离活动开始还有
                        <else/>
                        <if condition="$iswks eq 0">
                            微信认购结束倒计时
                            <else/>
                            微信认购已结束
                        </if>
                    </if>
                    </li>
                    <li>
                        <!--<span class="qw djs-time" >0</span>-->
                        <span class="bw djs-time" >0</span>小时
                        <span class="sw djs-time" >00</span>分
                        <span class="gw djs-time" >00</span>秒
                    </li>
                </ul>
            </div>
            <div class="begin-time" style="display:none;">
                <div style="text-align: center;position: absolute;display:none;"><{$project['name']}><div style="margin-top: 5px;">抢购进行中</div></div>

            </div>
            <!--<div class="remark" ><u>说明</u> </div>--》
            <!--<div class="ycwxrg">︽</div>-->
            <div class="remark" ><a href="/User/OrderHouse/collectedroom/id/<{$eventId}>.html"><i class="fa fa-refresh" style="font-size: 18px;color:#b9b9b9;"></i></a></div>
        </div>
    </div>
</div>
</block>

<block name="content">
    <div class="user-project-view-base">

        <div class="user-project-view-content-wrapper">
            <div class="user-project-view-content">			
                <div id="iscroller-wrapper" class="user-project-view-content-rooms iscroller-rooms iscroller-style" > 
                    <div id="iscroller-scroller" class="user-project-view-content-rooms-box iscroller-rooms-scroller iscroller-scroller-style">
                        <div class="speedbuy-content speedbuy-content-li">

                        </div>
                        <div class="block60 room-bottom-block" style="display:none;"></div>
                    </div>
                </div>

                <div class="user-project-view-content-selected-wrapper js-user-project-view-content-selected-wrapper">
                    <div class="user-project-view-content-selected">
                        <div class="user-project-view-content-selected-info">
                            <div class="user-project-view-content-selected-num-wrapper">
                                <span class="user-project-view-content-selected-num">
                                    0
                                </span>
                            </div>
                            <div class="user-project-view-content-selected-contrasts-wrapper">
                                <div class="user-project-view-content-selected-contrasts js-user-project-view-content-selected-compare">
                                    <span class="user-project-view-content-selected-contrasts-btn">
                                        开始对比
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="hdxz_div" id="iscroller-wrapper2">
        <div class="hdxz_content">
            <{$desc}>
        </div>
        <div class="hdxz_title">活动须知</div>
        <div  class="hdxz_footer" >
            <div  class="hdxz_btn hdxz_no" >不同意</div>
            <div class="hdxz_btn hdxz_yes" >同意</div>
        </div>
    </div>
    <div id="qrdddiv" style="position: absolute;width:100%;height:400px;background:#FFF;bottom:0px;z-index:999999;border-top:1px solid rgba(0, 150, 136, 0.1);display:none;">
        <div style="text-align:center;width:100%;padding:15px 0;border-bottom:1px solid #f7f7f7;font-size:16px;font-weight:bold;">确认订单</div>
        <div id="closeqrdd" style="position: absolute;right:3%;top:6px;height:40px;width:40px;border-radius:50%;line-height:40px;text-align:center;font-size: 22px;">×</div>
        <div style="line-height:30px;width:90%;margin: auto;">
            <div style="padding:5px 0 0 0;">[<{$projinfo.address}>]<span id="showdz" ></span></div>
            <div id="showroom" style="font-size:17px;border-bottom:1px solid #f7f7f7;"></div>
            <div style="">售价：<span id="showtotal"></span></div>
            <div id="showhx" style="border-bottom:1px solid #f7f7f7;"></div>
            <div style="">客户姓名：<{$userinfo['customer_name']}></div>
            <div style="">手机号码：<{$userinfo['customer_phone']}></div>
            <div style="">证件号码：<{$userinfo['cardno']}></div>
        </div>
        <div style="position: absolute;bottom:60px;text-align:center;width:100%;padding:20px 0;border-top:1px solid #f7f7f7;">
            <input type="checkbox" id="checkbox_a1" class="chk_1"  /> 
            <label for="checkbox_a1">我已阅读并同意</label>《<u id="seehdxz" style="color:red;cursor: pointer;">在线开盘活动须知</u>》 
        </div> 
        <div id="qrddbtn" class="qrddbtn" >确定</div>
    </div>
</block>
<block name="footer">
    <div class="weui-tabbar">
        <a href="/User/OrderHouse/index/id/<{$eventId}>.html" class="weui-tabbar__item ">
            <span style="display: inline-block;position: relative;">
                <i class="fa fa-list weui-tabbar__icon" ></i>
            </span>
            <p class="weui-tabbar__label">房源列表</p>
        </a>
        <!--<a href="javascript:;" class="weui-tabbar__item js-user-search-form-choose-btn">
            <span style="display: inline-block;position: relative;">
                <i class="fa fa-search weui-tabbar__icon" ></i>
            </span>
            <p class="weui-tabbar__label">房源筛选</p>
        </a>-->
        <a href="javascript:;" class="weui-tabbar__item weui-bar__item_on js-user-project-view-content-bxfy-btn ">
            <span style="display: inline-block;position: relative;">
                <i class="fa fa-heart weui-tabbar__icon" ></i>
                <span class="weui-badge user-project-view-content-gwc-num" style="position: absolute;top: 2px;right: -10px;display:none;">0</span>
            </span>
            <p class="weui-tabbar__label">备选房源</p>
        </a>
        <a href="/User/OrderHouse/myorder/id/<{$eventId}>.html" class="weui-tabbar__item">
            <span style="display: inline-block;position: relative;">
                <i class="fa fa-user-o weui-tabbar__icon" ></i>
                <span class="weui-badge weui-badge_dot" style="position: absolute;top: 2px;right: 0px;display:none;"></span>
            </span>
            <p class="weui-tabbar__label">我的订单</p>
        </a>
    </div>
</block>
<block name="footer_js">
<script src="__COMMON__/js/jquery/iscroll/iscroll.js"></script>
<script>
var iscroller_room;
var iscroller_room2;
function loaded() {
	setTimeout(function() {
		iscroller_room = new iScroll("iscroller-wrapper", {
			bounce: true,
			checkDOMChanges: true,
			onBeforeScrollStart: function (e) {
				var target = e.target;
				while (target.nodeType != 1) {
					target = target.parentNode;
				}

				if (target.tagName != 'SELECT' 
					&& target.tagName != 'INPUT' 
					&& target.tagName != 'TEXTAREA'
				) {
					e.preventDefault();
				}
			},
		});
                iscroller_room2 = new iScroll("iscroller-wrapper2", {
			bounce: true,
			checkDOMChanges: true,
			onBeforeScrollStart: function (e) {
				var target = e.target;
				while (target.nodeType != 1) {
					target = target.parentNode;
				}

				if (target.tagName != 'SELECT' 
					&& target.tagName != 'INPUT' 
					&& target.tagName != 'TEXTAREA'
				) {
					e.preventDefault();
				}
			},
		});
	}, 100);
}

document.addEventListener('touchmove', function (e) { 
	e.preventDefault(); 
}, false);
document.addEventListener('DOMContentLoaded', function () { 
	setTimeout(loaded, 200); 
}, false);

     document.addEventListener("visibilitychange", function(){
        if (document.visibilitychange!='hidden')
        {
             //window.location.href=window.location.href;
             window.location.href=window.location.protocol+"//"+window.location.host+window.location.pathname+'?time='+((new Date()).getTime())+window.location.hash;
        }
    });
    
    
var iscroller_index,
	pullDownEl, 
	pullDownOffset,
	loadingStep = 0;//加载状态0默认，1显示加载状态，2执行加载数据，只有当为0时才能再次加载，这是防止过快拉动刷新
 var total=0;
var eventId = "<{$eventId}>";

var collection = <{$roomCollected}>;

var orderedRoom = <{$orderedRoom}>;
var orderedRooms ;
var iswks=<{$iswks}>;

function renderCollection(collection) {
    var root = $('.speedbuy-content');

    var html = '<div style="width: 100%; text-align: center;margin-top: 50%; color:red;font-size:16px;">暂时没有添加备选房源！</div>';
    if (collection.length==0)
    {
        root.append(html);
    }
    for(var i = 0;i<collection.length;i++){
        if(orderedRoom.hasOwnProperty('room_id')&&orderedRoom['room_id']==collection[i]['id'])
        {
            var ulCss = 'bxf-ds';
            liCss = 'show-suc-btn1';

            divStatus = 'show-suc-div';
            divTxt = '查';

            spanCss = 'buy-suc';
            spanTxt = '成功';
            
           total= fmoney(collection[i]['total'],2)
            
            html = `<ul class="bxf-ul ${ulCss}" data-room-id="${collection[i]['id']}">																				
                    <li class=${liCss} style="float:left;width:14%;height:100%;">
                            <a href="/User/OrderHouse/ordershow/id/<{$eventId}>.html">
                                <div class="${divStatus}">${divTxt}</div>
                                <div style="margin-top:-40px;height:55px;border-right:1px solid #2196F3;"></div>
                            </a>
                    </li>										
                    <li style="float:left;width:70%;height:100%;">
                    <a href="/User/room/showroom/id/${collection[i]['id']}/eventId/${eventId}.html">
                            <ul style="margin-left:15px;">
                                    <li class="roominfo" style="height:24px;line-height:24px;padding: 4px 5px 0px 5px;font-size:13px;font-weight:bold;">
                                    ${collection[i]['building_name']}-${collection[i]['unit']}单元-${collection[i]['floor']}层-${collection[i]['room']}												
                                    </li>
                                    <li class="roomarea" style="height:20px;line-height:20px;padding: 2px 5px 0px 5px;font-size:12px;">
                                    <span class="roomhx" style="font-size:12px;font-weight:400;">户型：(${collection[i]['hx']})${collection[i]['hxmx']}</span>
                                    &nbsp;&nbsp;${collection[i]['area']} ㎡
                                    </li>
                                    <li style="height:20px;line-height:20px;padding: 2px 5px 0px 5px;font-size:12px;">
                                    售价：¥ <span class="roomtotal" style="font-weight:bold;">${total}</span>
                                    </li>
                            </ul>
                    </a>
                    </li>
                    <li style="float:left;width:15%;height:100%;">
                            <div style="line-height:25px;margin-top:25px;"><span class="buy-span ${spanCss}" >${spanTxt}</span></div>

                    </li>
            </ul>`;
            root.append(html);
            break;
        }
        else
        {
            continue;
        }
    }
    
    for(var i = 0;i<collection.length;i++){
        var ulCss = 'bxf-ds';
        if(i%2===1 && i!==0){
            ulCss = 'bxf-ss';
        }

        var liCss = 'sc-bxfy-btn';

        var divStatus = 'del-div';
        var divTxt = '×';
        
        var spanCss = 'wxrgbuy-button';
        var spanTxt = '认购';
        if (iswks==1)
             spanCss = '';
        
        var isyx=0;
        if(collection[i]['isyx']==1){
            isyx = 1;
        }
            
        if(collection[i]['status']==='1'){
            spanCss = '';
            spanTxt = '已售';
        }
        total= fmoney(collection[i]['total'],2)
        if(orderedRoom.hasOwnProperty('room_id')&&orderedRoom['room_id']==collection[i]['id']){
             continue;
        }

		html = `<ul class="bxf-ul ${ulCss}" data-room-id="${collection[i]['id']}">
                                                                                <li class=${liCss} style="float:left;width:14%;height:100%;">
											<div class="${divStatus}">${divTxt}</div>
											<div style="margin-top:-40px;height:55px;border-right:1px solid #2196F3;"></div>
										</li>										
                                                                                <li style="float:left;width:70%;height:100%;">
                                                                                <a href="/User/room/showroom/id/${collection[i]['id']}/eventId/${eventId}.html">
											<ul style="margin-left:15px;">
												<li class="roominfo" style="height:24px;line-height:24px;padding: 4px 5px 0px 5px;font-size:13px;font-weight:bold;">
												${collection[i]['building_name']}-${collection[i]['unit']}单元-${collection[i]['floor']}层-${collection[i]['room']}
												</li>
												<li class="roomarea" style="height:20px;line-height:20px;padding: 2px 5px 0px 5px;font-size:12px;">
												 <span class="roomhx" style="font-size:12px;font-weight:400;">户型：(${collection[i]['hx']})${collection[i]['hxmx']}</span>&nbsp;&nbsp;${collection[i]['area']} ㎡
                                                                                                </li>
												<li style="height:20px;line-height:20px;padding: 2px 5px 0px 5px;font-size:12px;">
												售价：¥ <span class="roomtotal" style="font-weight:bold;">${total}</span>
												</li>
											</ul>
                                                                                </a>
										</li>
										<li style="float:left;width:15%;height:100%;">
											<div style="line-height:25px;margin-top:25px;"><span class="buy-span ${spanCss}" isyx="${isyx}">${spanTxt}</span></div>

										</li>
									</ul>`;

        root.append(html);
        
    }
    var $ullist=$(".speedbuy-content-li").find(".bxf-ul");
            if ($ullist.length>0)
            {
                $ullist.removeClass("bxf-ds").removeClass("bxf-ss");
                for(var i=0;i<$ullist.length;i++)
                {
                    if(i % 2 == 0)
                        $ullist.eq(i).addClass("bxf-ds");
                    else
                        $ullist.eq(i).addClass("bxf-ss");
                }
            }

}
$(document).ready(function() {
	var $ishavehd=1;
        if(collection.length>0)
        {
            $("#showdz").text(collection[0]['project_name']);
        }
	if ($ishavehd==1)
	{
            if (iswks==1){
                $("#djs-type-title").removeClass("jxz");
                $(".djs-time").removeClass("yks").addClass("wks");
            }
            else
            {
                $("#djs-type-title").addClass("jxz");
                $(".djs-time").addClass("yks").removeClass("wks");
            }
            if(iswks>=0)
            {
                var $djs=$("#djstemp").text();
                //var times=$djs*100;
                showjsdjs($djs);
            }
	}
        
        if (orderedRoom.hasOwnProperty('code')){
        $(".div-success-rgm").html('签约号：'+orderedRoom.code);
	}

	renderCollection(collection);
        
        if (collection.length>0)
        {
            $('.user-project-view-content-gwc-num').html(collection.length).show();
        }
        else
        {
            $('.user-project-view-content-gwc-num').hide();
        }
        
        if (orderedRoom['room_id']>0)
        {
            $('.weui-badge_dot').show();
        } 
});

function renderRoom(rooms)
{
    var $btnlist=$(".speedbuy-content").find(".wxrgbuy-button");
    var $thiz;
    var $room_id;
    if($btnlist.length>0 && rooms.length>0)
    {
        for(var i = rooms.length-1; i >= 0; i--){
            for (j=0;j<$btnlist.length;j++)
            { 
                $thiz = $btnlist.eq(j).parent().parent().parent();
                $room_id = $thiz.attr("data-room-id");

                if($room_id==rooms[i] && $btnlist.eq(j).text()=="认购" && $btnlist.eq(j).attr("isyx")!=1)
                {
                    $btnlist.eq(j).text("已售").removeClass("wxrgbuy-button");
                    break;
                }
            }
        }
    }
}
//显示时间倒计时
function showjsdjs(times)
{
     var  interval = 1000,
          nextTime=1000,
          count = 0,
          startTime = new Date().getTime(); 
    var ms=Math.floor(times / 1000);
     $(".b").html(times);
    var gw = (Math.floor(ms%60) >9) ? Math.floor(ms%60): '0'+Math.floor(ms%60);//秒
    var sw = (Math.floor(ms/60%60) >=10) ? Math.floor(ms/60%60): '0'+ Math.floor(ms/60%60); //分
    var bw = Math.floor(ms/3600%60);//时
    $(".bw").text(bw);
    $(".sw").text(sw);
    $(".gw").text(gw);
   
    countTime = setInterval(function() {
                count++;
                if(count==60)
                {
                    clearInterval(countTime);
                    geteventdjs();
                }
                //times = --times < 0 ? 0 : times;
                times -= interval;
                if (times<0) 
                    times=0;
                ms = Math.floor(times / 1000);
                if(times == 0) {
                    clearInterval(countTime);
                    if (iswks==1)
                    {
                        var $djs=$("#djstemp1").text();
                        iswks=2;
                        showjsdjs($djs);
                    }
                    else if(iswks==3 || iswks==0)
                    {
                        $(".begin-time").text("微信认购已结束...");
                        $("#djs-type-title").text("微信认购已结束");
                        $spanlist=$(".speedbuy-content").find(".wxrgbuy-button");
                        if($spanlist && $spanlist.length>0)
                        {
                            for(var i=0;i<$spanlist.length;i++)
                            {
                                $spanlist.eq(i).removeClass("wxrgbuy-button").html("").text("结束");
                            }
                        }
                    }
                }
                else
                {
                    if(iswks==2)
                    {
                        $("#djs-type-title").text("微信认购结束倒计时").addClass("jxz");
                        $(".djs-time").addClass("yks").removeClass("wks");
                        $spanlist=$(".speedbuy-content").find(".buy-span");
                        if($spanlist && $spanlist.length>0)
                        {
                            for(var i=0;i<$spanlist.length;i++)
                            {
                                if($spanlist.eq(i).text() == "认购")
                                    $spanlist.eq(i).addClass("wxrgbuy-button");
                            }
                        }
                        iswks=3;
                    }
                }   
                //$(".a").html(ms);
                //$(".b").html(hm);
                var offset = new Date().getTime() - (startTime + count * interval);
                nextTime = interval - offset;
                gw = (Math.floor(ms%60) >9) ? Math.floor(ms%60): '0'+Math.floor(ms%60);//秒
                sw = (Math.floor(ms/60%60) >=10) ? Math.floor(ms/60%60): '0'+ Math.floor(ms/60%60); //分
                bw = Math.floor(ms/3600%60);//时
                $(".bw").text(bw);
                $(".sw").text(sw);
                $(".gw").text(gw);
        }, nextTime);
}
//单独获取倒计时
function geteventdjs(){
    var $data = {
        id: eventId
    };
    var $url = orderHouse.getdjs;
    ajax_post_callback($url, $data, function (data, status) {
            if (data.status==1) { 
               var djsinfo = data.info[1];
               iswks=djsinfo['iswks'];
               $("#djstemp").text(djsinfo['time']);
               $("#djstemp1").text(djsinfo['time1']);
               showjsdjs(djsinfo['time']);
            }else {
                
            }
        })
}

window.addEventListener('hashchange', function(ev){
    //console.log(ev);
   if(location.hash=="#first")
   {
        $("#qrdddiv").show();
         $(".div-zz").show();
   }
   if(location.hash=="")
   {    
        $("#qrdddiv").hide();
        $(".div-zz").hide();
   }
});

$("body").on("click","#qrddbtn",function(){
    if(!$(this).hasClass("tyyd"))
    {
        return false;
    }
    var isty=$("#checkbox_a1").is(':checked');
    if (!isty)
    {
        return false;
    }
    xfqr($(this).attr("room_id"),eventId)
    $("#qrdddiv").hide();
    $(".div-zz").hide();
});

$("#checkbox_a1").click(function(){
    var isty=$("#checkbox_a1").is(':checked');
    if (isty)
    {
        $("#qrddbtn").addClass("tyyd");
    }
    else
    {
        $("#qrddbtn").removeClass("tyyd");
    }
});


function xfqr(room_id,eventId)
{
    var $data = {
            room_id: room_id,
            eventId: eventId
        };
        var $url = orderHouse.add;
        $('#loading').show();
        ajax_post_callback($url, $data, function (data, status) {
            if (data.status==1) {
                $(".div-success-rgm").html('签约号：' + data.info[1]);
                $(".div-success-no").text($("#showroom").text());
                $(".div-success-area").text($("#showhx").text());
                $(".div-success-total").text($("#showtotal").text());
                $(".div-success").show();
                $(".div-zz").show();
                $('.weui-badge_dot').show();
                var $html='<a href="/User/OrderHouse/ordershow/id/'+eventId+'.html"><div class="show-suc-div">查</div><div style="margin-top:-40px;height:55px;border-right:1px solid #2196F3;"></div></a>';
                var $dqys=$("#libtn_"+room_id);
                $dqys.text("成功").removeClass("wxrgbuy-button").addClass("buy-suc");
                $dqys.parent().parent().parent().children(":first").removeClass("sc-bxfy-btn").addClass("show-suc-btn1").html($html);
                
                orderedRooms = data.info[2];
                renderRoom(orderedRooms);
                
            } else {
                var $data = {
                    eventId: eventId
                };
                ajax_post_callback('/user/OrderHouse/getAllOrderedRooms', $data, function (data, status) {
                    orderedRooms = data.info[1];
                    renderRoom(orderedRooms);
                });
                layer_alert(data.info);
            }
        });

        return false;
}

$("#closeqrdd").click(function(){
    $("#qrdddiv").hide();
    $(".div-zz").hide();
});
$("#seehdxz").click(function(){
    $(".hdxz_div").show();
});
$("#closehdxz").click(function(){
    $(".hdxz_div").hide();
});
$(".hdxz_no").click(function(){
    $(".hdxz_div").hide();
    $("#checkbox_a1").prop("checked",false); 
    $("#qrddbtn").removeClass("tyyd");
});
$(".hdxz_yes").click(function(){
    $(".hdxz_div").hide();
    $("#checkbox_a1").prop("checked",true); 
    $("#qrddbtn").addClass("tyyd");
});

 function fmoney(s, n)  
        {  
           n = n > 0 && n <= 20 ? n : 2;  
           s = parseFloat((s + "").replace(/[^\d\.-]/g, "")).toFixed(n) + "";//更改这里n数也可确定要保留的小数位  
           var l = s.split(".")[0].split("").reverse(),  
           r = s.split(".")[1];  
           t = "";  
           for(i = 0; i < l.length; i++ )  
           {  
              t += l[i] + ((i + 1) % 3 == 0 && (i + 1) != l.length ? "," : "");  
           }  
           return t.split("").reverse().join("") + "." + r.substring(0,2);//保留2位小数  如果要改动 把substring 最后一位数改动就可  
        }
</script>
</block>
